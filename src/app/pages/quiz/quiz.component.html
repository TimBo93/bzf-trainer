<div class="min-h-screen flex flex-col">
  @if (isLoading()) {
  <!-- Loading state -->
  <div class="flex-1 flex items-center justify-center p-4">
    <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-primary"></div>
  </div>
  } @else if (!hasSession() && hasActiveQuiz()) {
  <!-- Saved quiz available -->
  <div class="flex-1 flex items-center justify-center p-4">
    <div class="text-center max-w-md">
      <div
        class="w-16 h-16 rounded-full bg-primary/10 flex items-center justify-center mx-auto mb-6"
      >
        <lucide-icon [img]="RotateCcw" class="h-8 w-8 text-primary"></lucide-icon>
      </div>
      <h2 class="text-xl font-semibold mb-2">Quiz fortsetzen?</h2>
      <p class="text-muted-foreground mb-8">
        Du hast ein laufendes Quiz, das du fortsetzen kannst.
      </p>
      <div class="flex flex-col sm:flex-row gap-3 justify-center">
        <button
          (click)="goHome()"
          class="inline-flex items-center justify-center gap-2 px-5 py-3 border rounded-xl hover:bg-secondary transition-colors"
        >
          <lucide-icon [img]="Home" class="h-4 w-4"></lucide-icon>
          Zur Startseite
        </button>
        <button
          (click)="continueQuiz()"
          class="inline-flex items-center justify-center gap-2 px-5 py-3 bg-primary text-primary-foreground rounded-xl hover:bg-primary/90 transition-colors"
        >
          <lucide-icon [img]="RotateCcw" class="h-4 w-4"></lucide-icon>
          Quiz fortsetzen
        </button>
      </div>
    </div>
  </div>
  } @else if (!hasSession()) {
  <!-- No active session -->
  <div class="flex-1 flex items-center justify-center p-4">
    <div class="text-center">
      <h2 class="text-xl font-semibold mb-4">Kein aktives Quiz</h2>
      <a
        routerLink="/"
        class="inline-flex items-center gap-2 px-4 py-2 bg-primary text-primary-foreground rounded-lg hover:bg-primary/90"
      >
        <lucide-icon [img]="ArrowLeft" class="h-4 w-4"></lucide-icon>
        Zurück zur Startseite
      </a>
    </div>
  </div>
  } @else {
  <!-- Progress Bar -->
  <div class="sticky top-14 z-40 bg-background/95 backdrop-blur border-b">
    <div class="container mx-auto px-4 py-3">
      <div class="flex items-center justify-between mb-2">
        <div class="flex items-center gap-3">
          <button
            (click)="exitQuiz()"
            class="p-2 rounded-lg hover:bg-accent transition-colors"
            title="Quiz beenden"
          >
            <lucide-icon [img]="X" class="h-5 w-5"></lucide-icon>
          </button>
          <span class="text-sm font-medium">
            Frage {{ currentNumber() }} von {{ totalQuestions() }}
          </span>
        </div>
        <div class="flex items-center gap-3 text-sm">
          <span class="flex items-center gap-1 text-green-600">
            <lucide-icon [img]="CheckCircle" class="h-4 w-4"></lucide-icon>
            {{ correctCount() }}
          </span>
          <span class="flex items-center gap-1 text-red-500">
            <lucide-icon [img]="XCircle" class="h-4 w-4"></lucide-icon>
            {{ wrongCount() }}
          </span>
        </div>
      </div>
      <div class="w-full bg-secondary rounded-full h-2">
        <div
          class="bg-primary h-2 rounded-full transition-all duration-300"
          [style.width.%]="progress()"
        ></div>
      </div>
    </div>
  </div>

  <!-- Question Content -->
  <div class="flex-1 container mx-auto px-4 py-6 max-w-3xl">
    @if (currentQuestion(); as question) {
    <!-- Category Badge -->
    @if (category(); as cat) {
    <div class="mb-4">
      <span
        class="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-primary/10 text-primary"
      >
        {{ cat.name }}
      </span>
    </div>
    }

    <!-- Question Number & Text -->
    <div class="mb-6">
      <span class="text-sm text-muted-foreground mb-2 block"
        >Frage {{ question.original.number }}</span
      >
      <h2 class="text-lg sm:text-xl font-medium leading-relaxed">
        {{ question.original.question }}
      </h2>
    </div>

    <!-- Answers -->
    <div class="space-y-3 mb-8">
      @for (answer of question.shuffledAnswers; track answer.label) {
      <button
        (click)="selectAnswer(answer.label)"
        [disabled]="showFeedback()"
        [class]="getAnswerClass(answer.label)"
      >
        <div class="flex items-start gap-3">
          <span
            class="flex-shrink-0 w-8 h-8 rounded-full bg-secondary flex items-center justify-center font-medium text-sm"
          >
            {{ answer.label }}
          </span>
          <span class="flex-1 pt-1">{{ answer.text }}</span>
          @if (showFeedback()) { @if (answer.isCorrect) {
          <lucide-icon
            [img]="CheckCircle"
            class="h-6 w-6 text-green-500 flex-shrink-0"
          ></lucide-icon>
          } @else if (selectedAnswer() === answer.label) {
          <lucide-icon [img]="XCircle" class="h-6 w-6 text-red-500 flex-shrink-0"></lucide-icon>
          } }
        </div>
      </button>
      }
    </div>

    <!-- Feedback Message -->
    @if (showFeedback()) {
    <div
      class="mb-6 p-4 rounded-xl"
      [class]="
        isAnswerCorrect(selectedAnswer()!)
          ? 'bg-green-500/10 border border-green-500/20'
          : 'bg-red-500/10 border border-red-500/20'
      "
    >
      @if (isAnswerCorrect(selectedAnswer()!)) {
      <p class="font-medium text-green-600">✓ Richtig!</p>
      } @else {
      <p class="font-medium text-red-500">✗ Leider falsch</p>
      <p class="text-sm text-muted-foreground mt-1">
        Die richtige Antwort war:
        <strong>{{ getCorrectAnswerText() }}</strong>
      </p>
      }
    </div>
    }

    <!-- Action Buttons -->
    <div class="flex gap-3">
      @if (showFeedback()) { @if (isLastQuestion()) {
      <button
        (click)="finishQuiz()"
        class="flex-1 py-3 px-6 bg-primary text-primary-foreground rounded-xl font-medium hover:bg-primary/90 transition-colors flex items-center justify-center gap-2"
      >
        Quiz beenden
        <lucide-icon [img]="CheckCircle" class="h-5 w-5"></lucide-icon>
      </button>
      } @else {
      <button
        (click)="nextQuestion()"
        class="flex-1 py-3 px-6 bg-primary text-primary-foreground rounded-xl font-medium hover:bg-primary/90 transition-colors flex items-center justify-center gap-2"
      >
        Nächste Frage
        <lucide-icon [img]="ArrowRight" class="h-5 w-5"></lucide-icon>
      </button>
      } }
    </div>
    }
  </div>
  }
</div>
